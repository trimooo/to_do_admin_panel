{"version":3,"file":"GlobalFiltering.js","sources":["../../../src/features/GlobalFiltering.ts"],"sourcesContent":["import { FilterFn, FilterFnOption, RowModel } from '..'\nimport { BuiltInFilterFn, filterFns } from '../filterFns'\nimport {\n  Column,\n  OnChangeFn,\n  Table,\n  Updater,\n  RowData,\n  TableFeature,\n} from '../types'\nimport { isFunction, makeStateUpdater } from '../utils'\n\nexport interface GlobalFilterTableState {\n  globalFilter: any\n}\n\nexport interface GlobalFilterColumnDef {\n  /**\n   * Enables/disables the **global** filter for this column.\n   * @link [API Docs](https://tanstack.com/table/v8/docs/api/features/filters#enableglobalfilter)\n   * @link [Guide](https://tanstack.com/table/v8/docs/guide/filters)\n   */\n  enableGlobalFilter?: boolean\n}\n\nexport interface GlobalFilterColumn {\n  /**\n   * Returns whether or not the column can be **globally** filtered. Set to `false` to disable a column from being scanned during global filtering.\n   * @link [API Docs](https://tanstack.com/table/v8/docs/api/features/filters#getcanglobalfilter)\n   * @link [Guide](https://tanstack.com/table/v8/docs/guide/filters)\n   */\n  getCanGlobalFilter: () => boolean\n}\n\nexport interface GlobalFilterOptions<TData extends RowData> {\n  /**\n   * Enables/disables **global** filtering for all columns.\n   * @link [API Docs](https://tanstack.com/table/v8/docs/api/features/filters#enableglobalfilter)\n   * @link [Guide](https://tanstack.com/table/v8/docs/guide/filters)\n   */\n  enableGlobalFilter?: boolean\n  /**\n   * If provided, this function will be called with the column and should return `true` or `false` to indicate whether this column should be used for global filtering.\n   *\n   * This is useful if the column can contain data that is not `string` or `number` (i.e. `undefined`).\n   * @link [API Docs](https://tanstack.com/table/v8/docs/api/features/filters#getcolumncanglobalfilter)\n   * @link [Guide](https://tanstack.com/table/v8/docs/guide/filters)\n   */\n  getColumnCanGlobalFilter?: (column: Column<TData, unknown>) => boolean\n  /**\n   * The filter function to use for global filtering.\n   * - A `string` referencing a built-in filter function\n   * - A `string` that references a custom filter functions provided via the `tableOptions.filterFns` option\n   * - A custom filter function\n   * @link [API Docs](https://tanstack.com/table/v8/docs/api/features/filters#globalfilterfn)\n   * @link [Guide](https://tanstack.com/table/v8/docs/guide/filters)\n   */\n  globalFilterFn?: FilterFnOption<TData>\n  /**\n   * If provided, this function will be called with an `updaterFn` when `state.globalFilter` changes. This overrides the default internal state management, so you will need to persist the state change either fully or partially outside of the table.\n   * @link [API Docs](https://tanstack.com/table/v8/docs/api/features/filters#onglobalfilterchange)\n   * @link [Guide](https://tanstack.com/table/v8/docs/guide/filters)\n   */\n  onGlobalFilterChange?: OnChangeFn<any>\n}\n\nexport interface GlobalFilterInstance<TData extends RowData> {\n  _getGlobalFacetedMinMaxValues?: () => undefined | [number, number]\n  _getGlobalFacetedRowModel?: () => RowModel<TData>\n  _getGlobalFacetedUniqueValues?: () => Map<any, number>\n  /**\n   * Currently, this function returns the built-in `includesString` filter function. In future releases, it may return more dynamic filter functions based on the nature of the data provided.\n   * @link [API Docs](https://tanstack.com/table/v8/docs/api/features/filters#getglobalautofilterfn)\n   * @link [Guide](https://tanstack.com/table/v8/docs/guide/filters)\n   */\n  getGlobalAutoFilterFn: () => FilterFn<TData> | undefined\n  /**\n   * Returns the faceted min and max values for the global filter.\n   * @link [API Docs](https://tanstack.com/table/v8/docs/api/features/filters#getglobalfacetedminmaxvalues)\n   * @link [Guide](https://tanstack.com/table/v8/docs/guide/filters)\n   */\n  getGlobalFacetedMinMaxValues: () => undefined | [number, number]\n  /**\n   * Returns the row model for the table after **global** filtering has been applied.\n   * @link [API Docs](https://tanstack.com/table/v8/docs/api/features/filters#getglobalfacetedrowmodel)\n   * @link [Guide](https://tanstack.com/table/v8/docs/guide/filters)\n   */\n  getGlobalFacetedRowModel: () => RowModel<TData>\n  /**\n   * Returns the faceted unique values for the global filter.\n   * @link [API Docs](https://tanstack.com/table/v8/docs/api/features/filters#getglobalfaceteduniquevalues)\n   * @link [Guide](https://tanstack.com/table/v8/docs/guide/filters)\n   */\n  getGlobalFacetedUniqueValues: () => Map<any, number>\n  /**\n   * Returns the filter function (either user-defined or automatic, depending on configuration) for the global filter.\n   * @link [API Docs](https://tanstack.com/table/v8/docs/api/features/filters#getglobalfilterfn)\n   * @link [Guide](https://tanstack.com/table/v8/docs/guide/filters)\n   */\n  getGlobalFilterFn: () => FilterFn<TData> | undefined\n  /**\n   * Resets the **globalFilter** state to `initialState.globalFilter`, or `true` can be passed to force a default blank state reset to `undefined`.\n   * @link [API Docs](https://tanstack.com/table/v8/docs/api/features/filters#resetglobalfilter)\n   * @link [Guide](https://tanstack.com/table/v8/docs/guide/filters)\n   */\n  resetGlobalFilter: (defaultState?: boolean) => void\n  /**\n   * Sets or updates the `state.globalFilter` state.\n   * @link [API Docs](https://tanstack.com/table/v8/docs/api/features/filters#setglobalfilter)\n   * @link [Guide](https://tanstack.com/table/v8/docs/guide/filters)\n   */\n  setGlobalFilter: (updater: Updater<any>) => void\n}\n\n//\n\nexport const GlobalFiltering: TableFeature = {\n  getInitialState: (state): GlobalFilterTableState => {\n    return {\n      globalFilter: undefined,\n      ...state,\n    }\n  },\n\n  getDefaultOptions: <TData extends RowData>(\n    table: Table<TData>\n  ): GlobalFilterOptions<TData> => {\n    return {\n      onGlobalFilterChange: makeStateUpdater('globalFilter', table),\n      globalFilterFn: 'auto',\n      getColumnCanGlobalFilter: column => {\n        const value = table\n          .getCoreRowModel()\n          .flatRows[0]?._getAllCellsByColumnId()\n          [column.id]?.getValue()\n\n        return typeof value === 'string' || typeof value === 'number'\n      },\n    } as GlobalFilterOptions<TData>\n  },\n\n  createColumn: <TData extends RowData>(\n    column: Column<TData, unknown>,\n    table: Table<TData>\n  ): void => {\n    column.getCanGlobalFilter = () => {\n      return (\n        (column.columnDef.enableGlobalFilter ?? true) &&\n        (table.options.enableGlobalFilter ?? true) &&\n        (table.options.enableFilters ?? true) &&\n        (table.options.getColumnCanGlobalFilter?.(column) ?? true) &&\n        !!column.accessorFn\n      )\n    }\n  },\n\n  createTable: <TData extends RowData>(table: Table<TData>): void => {\n    table.getGlobalAutoFilterFn = () => {\n      return filterFns.includesString\n    }\n\n    table.getGlobalFilterFn = () => {\n      const { globalFilterFn: globalFilterFn } = table.options\n\n      return isFunction(globalFilterFn)\n        ? globalFilterFn\n        : globalFilterFn === 'auto'\n          ? table.getGlobalAutoFilterFn()\n          : // @ts-ignore\n            table.options.filterFns?.[globalFilterFn as string] ??\n            filterFns[globalFilterFn as BuiltInFilterFn]\n    }\n\n    table.setGlobalFilter = updater => {\n      table.options.onGlobalFilterChange?.(updater)\n    }\n\n    table.resetGlobalFilter = defaultState => {\n      table.setGlobalFilter(\n        defaultState ? undefined : table.initialState.globalFilter\n      )\n    }\n\n    table._getGlobalFacetedRowModel =\n      table.options.getFacetedRowModel &&\n      table.options.getFacetedRowModel(table, '__global__')\n\n    table.getGlobalFacetedRowModel = () => {\n      if (table.options.manualFiltering || !table._getGlobalFacetedRowModel) {\n        return table.getPreFilteredRowModel()\n      }\n\n      return table._getGlobalFacetedRowModel()\n    }\n\n    table._getGlobalFacetedUniqueValues =\n      table.options.getFacetedUniqueValues &&\n      table.options.getFacetedUniqueValues(table, '__global__')\n    table.getGlobalFacetedUniqueValues = () => {\n      if (!table._getGlobalFacetedUniqueValues) {\n        return new Map()\n      }\n\n      return table._getGlobalFacetedUniqueValues()\n    }\n\n    table._getGlobalFacetedMinMaxValues =\n      table.options.getFacetedMinMaxValues &&\n      table.options.getFacetedMinMaxValues(table, '__global__')\n    table.getGlobalFacetedMinMaxValues = () => {\n      if (!table._getGlobalFacetedMinMaxValues) {\n        return\n      }\n\n      return table._getGlobalFacetedMinMaxValues()\n    }\n  },\n}\n"],"names":["GlobalFiltering","getInitialState","state","globalFilter","undefined","getDefaultOptions","table","onGlobalFilterChange","makeStateUpdater","globalFilterFn","getColumnCanGlobalFilter","column","_table$getCoreRowMode","value","getCoreRowModel","flatRows","_getAllCellsByColumnId","id","getValue","createColumn","getCanGlobalFilter","_column$columnDef$ena","_table$options$enable","_table$options$enable2","_table$options$getCol","columnDef","enableGlobalFilter","options","enableFilters","accessorFn","createTable","getGlobalAutoFilterFn","filterFns","includesString","getGlobalFilterFn","_table$options$filter","_table$options$filter2","isFunction","setGlobalFilter","updater","resetGlobalFilter","defaultState","initialState","_getGlobalFacetedRowModel","getFacetedRowModel","getGlobalFacetedRowModel","manualFiltering","getPreFilteredRowModel","_getGlobalFacetedUniqueValues","getFacetedUniqueValues","getGlobalFacetedUniqueValues","Map","_getGlobalFacetedMinMaxValues","getFacetedMinMaxValues","getGlobalFacetedMinMaxValues"],"mappings":"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"}