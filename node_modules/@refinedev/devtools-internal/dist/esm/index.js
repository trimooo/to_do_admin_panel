"use client"
import I from"error-stack-parser";var v="renderWithHooks",m=r=>{let e=r.findIndex(s=>s.functionName===v);return e!==-1?r.slice(0,e):r};var i=process.env.NODE_ENV!=="development"?/node_modules\/refinedev\/(?<name>.*?)\//:/\/refine\/packages\/(?<name>.*?)\//;var y=r=>r?!!r.match(i):!1;var d=r=>{var n;if(!r)return;let e=r.match(i),s=(n=e==null?void 0:e.groups)==null?void 0:n.name;if(s)return`@refinedev/${s}`};function p(){if(process.env.NODE_ENV!=="development")return[];try{let r=new Error,e=I.parse(r);return m(e).map(t=>({file:t.fileName,line:t.lineNumber,column:t.columnNumber,function:t.functionName,isRefine:y(t.fileName),packageName:d(t.fileName)})).filter(t=>t.function).slice(1)}catch{return[]}}import{scopes as u}from"@refinedev/devtools-shared";var E=(r,e)=>{if(u[r]==="auth")return null;if(r==="useCan")return e?"key[1].resource":"key[1]";if(u[r]==="audit-log")return r==="useLog"?"variables.resource":"key[1]";if(u[r]==="data"){if(r==="useCustom"||r==="useCustomMutation")return null;switch(r){case"useList":case"useInfiniteList":case"useOne":case"useMany":return e?"key[1]":"key[2]";case"useCreate":case"useCreateMany":case"useDelete":case"useDeleteMany":case"useUpdate":case"useUpdateMany":return"variables.resource"}}return null};function P(r,e){if(process.env.NODE_ENV!=="development")return{hookName:"",trace:[],resourcePath:null,legacyKey:!1};let s=p().slice(1),n=E(r,e);return{hookName:r,trace:s,resourcePath:n,legacyKey:e}}import{DevToolsContext as k}from"@refinedev/devtools-shared";import f,{useContext as x}from"react";import{DevtoolsEvent as T,send as _}from"@refinedev/devtools-shared";var l=(r,e)=>{let s=e==null?void 0:e.map(t=>`${t.file}:${t.line}:${t.column}#${t.function}-${t.packageName}-${t.isRefine?1:0}`);return JSON.stringify([...r??[],...s??[]])};var R=r=>e=>{var n;if(!((n=e==null?void 0:e.meta)!=null&&n.trace))return;let s=e==null?void 0:e.meta;new Promise(t=>{var a,o;_(r,T.ACTIVITY,{type:"mutation",identifier:l(e==null?void 0:e.options.mutationKey,(a=e==null?void 0:e.meta)==null?void 0:a.trace),key:e==null?void 0:e.options.mutationKey,status:e==null?void 0:e.state.status,state:e==null?void 0:e.state,variables:(o=e==null?void 0:e.state)==null?void 0:o.variables,...s}),t()})},g=r=>e=>{var n;if(!((n=e==null?void 0:e.meta)!=null&&n.trace))return;let s=e==null?void 0:e.meta;new Promise(t=>{var a;_(r,T.ACTIVITY,{type:"query",identifier:l(e.queryKey,(a=e.meta)==null?void 0:a.trace),key:e.queryKey,status:e.state.status,state:e.state,...s}),t()})};var C=process.env.NODE_ENV!=="development"?()=>({}):r=>{let{ws:e}=x(k),s=f.useRef(),n=f.useRef();return f.useEffect(()=>{if(!e)return()=>0;let t=r.getQueryCache(),a=g(e);return t.getAll().forEach(a),s.current=t.subscribe(({query:o,type:c})=>(c==="added"||c==="updated")&&a(o)),()=>{var o;(o=s.current)==null||o.call(s)}},[e,r]),f.useEffect(()=>{if(!e)return()=>0;let t=r.getMutationCache(),a=R(e);return t.getAll().forEach(a),n.current=t.subscribe(({mutation:o,type:c})=>(c==="added"||c==="updated")&&a(o)),()=>{var o;(o=n.current)==null||o.call(n)}},[e,r]),{}};export{p as getTrace,P as getXRay,C as useQuerySubscription};
//# sourceMappingURL=index.js.map